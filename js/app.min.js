var THP=THP||{};THP.App=function(){function i(){j()}function j(){e.querySelector("h2").innerHTML="Drag a photo from your desktop into the box below";var a=document.createElement("canvas");a.setAttribute("width",620),a.setAttribute("height",620);var b=document.createElement("a");b.setAttribute("id","js-btn-filter"),b.setAttribute("class","btn-filter disabled"),b.setAttribute("target","_blank"),b.appendChild(document.createTextNode("Holgafy!")),e.insertBefore(a,f),e.insertBefore(b,f),k()}function k(){a=document.getElementById("js-btn-filter"),b=e.querySelector("canvas"),c=b.getContext("2d"),b.addEventListener("dragover",function(a){a.preventDefault(),this.classList.add("hover")},!1),b.addEventListener("dragend",function(a){a.preventDefault(),this.classList.remove("hover")},!1),document.documentElement.addEventListener("drop",l,!0),a.addEventListener("click",n,!1)}function l(f){f.preventDefault(),b.classList.remove("hover"),e.querySelector(".error")&&e.removeChild(e.querySelector(".error"));var g=f.dataTransfer.files[0],h=new FileReader;h.onload=function(a){d=new Image,c.clearRect(0,0,b.width,b.height),d.onload=function(){c.drawImage(d,0,0,620,620)},d.src=a.target.result},h.onerror=m,h.readAsDataURL(g),a.classList.remove("disabled")}function m(){e.querySelector("header").insertAdjacentHTML("afterend",'<p class="error">It looks like there was an issue with the file. You can either retry or select another one to upload.</p>')}function n(){var a,d=c.getImageData(0,0,b.width,b.height),e=d.data,f=e.length;for(var g=0;g<f;g+=4)a=.38*e[g]+.5*e[g+1]+.18*e[g+2],e[g]=a,e[g+1]=a,e[g+2]=a;c.putImageData(d,0,0);var h;c.globalAlpha=.5;for(h=-1;h<2;h+=1)c.drawImage(b,h,0);c.globalAlpha=1,o()}function o(){var d,e=Math.sqrt(Math.pow(b.width/2,2)+Math.pow(b.height/2,2));d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,e),d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(.65,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,14)"),c.fillStyle=d,c.fillRect(0,0,b.width,b.height),d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,e),d.addColorStop(0,"rgba(255,255,255,0.2)"),d.addColorStop(.65,"rgba(255,255,255,0)"),d.addColorStop(1,"rgba(0,0,0,0)"),c.fillStyle=d,c.fillRect(0,0,b.width,b.height),a.removeEventListener("click",n),a.innerHTML="Save Image",a.addEventListener("click",p,!0)}function p(a){a.preventDefault(),g=b.toDataURL("image/png"),h="image/octet-stream",q(g.replace("image/png",h))}function q(a){document.location.href=a}var a,b,c,d,e=document.getElementById("js-shell"),f=e.querySelector("footer"),g,h;return{init:i}}(),THP.Initializer={init:function(){this.isCompatible()},detectCanvasSupport:function(){var a=document.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},detectDragAndDropSupport:function(){var a=document.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},detectFileReaderSupport:function(){return!!window.File&&!!window.FileReader},isCompatible:function(){this.detectCanvasSupport()&&this.detectDragAndDropSupport()&&this.detectFileReaderSupport()?THP.App.init():document.querySelector("h2").innerHTML='It looks like your browser doesn\'t support the features this site needs to work. Download the latest versions of <a href="https://www.google.com/chrome" target="_blank">Google Chrome</a> or <a href="http://www.mozilla.org/firefox/" target="_blank">Mozilla Firefox</a> in order to view it.'}},THP.Initializer.init();