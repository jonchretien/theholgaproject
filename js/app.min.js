(function(){"use strict";var a=a||{};a.App=function(){function i(){j()}function j(){e.querySelector("h2").innerHTML="Drag a photo from your desktop into the box below";var d=document.createElement("canvas");d.setAttribute("width",620),d.setAttribute("height",620);var g=document.createElement("a");g.setAttribute("id","js-btn-filter"),g.setAttribute("class","btn-filter disabled"),g.setAttribute("href","#"),g.appendChild(document.createTextNode("Holgafy!")),e.insertBefore(d,f),e.insertBefore(g,f),a=document.getElementById("js-btn-filter"),b=e.querySelector("canvas"),c=b.getContext("2d"),k()}function k(){b.addEventListener("dragover",l,!1),b.addEventListener("dragend",m,!1),document.documentElement.addEventListener("drop",o,!0),a.addEventListener("click",q,!1)}function l(a){a.preventDefault(),a.target.classList.add("hover")}function m(a){a.preventDefault(),a.target.classList.remove("hover")}function n(){b.removeEventListener("dragover",l,!1),b.removeEventListener("dragend",m,!1),document.documentElement.removeEventListener("drop",o,!0),a.removeEventListener("click",q,!1)}function o(f){f.preventDefault(),b.classList.remove("hover"),e.querySelector(".error")&&e.removeChild(e.querySelector(".error"));var g=f.dataTransfer.files[0],h=new FileReader;h.onload=function(a){d=new Image,c.clearRect(0,0,b.width,b.height),d.onload=function(){c.drawImage(d,0,0,620,620)},d.src=a.target.result},h.onerror=p,h.readAsDataURL(g),a.classList.remove("disabled")}function p(){e.querySelector("header").insertAdjacentHTML("afterend",'<p class="error">It looks like there was an issue with the file. You can either retry or select another one to upload.</p>')}function q(a){a.preventDefault();var d,e=c.getImageData(0,0,b.width,b.height),f=e.data,g=f.length;for(var h=0;h<g;h+=4)d=.38*f[h]+.5*f[h+1]+.18*f[h+2],f[h]=d,f[h+1]=d,f[h+2]=d;c.putImageData(e,0,0),c.globalAlpha=.5;for(var i=-1;i<2;i+=1)c.drawImage(b,i,0);c.globalAlpha=1,r()}function r(){var d,e=Math.sqrt(Math.pow(b.width/2,2)+Math.pow(b.height/2,2));d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,e),d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(.65,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,14)"),c.fillStyle=d,c.fillRect(0,0,b.width,b.height),d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,e),d.addColorStop(0,"rgba(255,255,255,0.2)"),d.addColorStop(.65,"rgba(255,255,255,0)"),d.addColorStop(1,"rgba(0,0,0,0)"),c.fillStyle=d,c.fillRect(0,0,b.width,b.height),n(),a.innerHTML="Save Image",a.addEventListener("click",s,!0)}function s(a){a.preventDefault(),g=b.toDataURL("image/png"),h="image/octet-stream",t(g.replace("image/png",h))}function t(a){document.location.href=a}var a,b,c,d,e=document.getElementById("js-shell"),f=e.querySelector("footer"),g,h;return{init:i}}(),a.Initializer={init:function(){this.isCompatible()},detectCanvasSupport:function(){var a=document.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},detectDragAndDropSupport:function(){var a=document.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},detectFileReaderSupport:function(){return!!window.File&&!!window.FileReader},isCompatible:function(){this.detectCanvasSupport()&&this.detectDragAndDropSupport()&&this.detectFileReaderSupport()?a.App.init():document.querySelector("h2").innerHTML='It looks like your browser doesn\'t support the features this site needs to work. Download the latest versions of <a href="https://www.google.com/chrome" target="_blank">Google Chrome</a> or <a href="http://www.mozilla.org/firefox/" target="_blank">Mozilla Firefox</a> in order to view it.'}},a.Initializer.init()})();